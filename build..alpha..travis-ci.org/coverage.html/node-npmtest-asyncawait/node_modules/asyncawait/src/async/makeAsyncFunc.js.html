<!doctype html>
<html lang="en">
<head>
    <title>Code coverage report for node-npmtest-asyncawait/node_modules/asyncawait/src/async/makeAsyncFunc.js</title>
    <meta charset="utf-8">
    <style>
        body, html {
            margin:0; padding: 0;
        }
        body {
            font-family: Arial, Helvetica;
            font-size: 10pt;
        }
        div.header, div.footer {
            background: #eee;
            padding: 1em;
        }
        div.header {
            height: 160px;
            padding: 0 1em 0 1em;
            z-index: 100;
            position: fixed;
            top: 0;
            border-bottom: 1px solid #666;
            width: 100%;
        }
        div.footer {
            border-top: 1px solid #666;
        }
        div.body {
            margin-top: 170px;
        }
        div.meta {
            font-size: 90%;
            text-align: center;
        }
        h1, h2, h3 {
            font-weight: normal;
        }
        h1 {
            font-size: 12pt;
        }
        h2 {
            font-size: 10pt;
        }
        pre {
            font-family: Menlo, Monaco, Consolas, Courier New, monospace;
            margin: 0;
            padding: 0;
            font-size: 14px;
            tab-size: 2;
        }

        div.path { font-size: 110%; }
        div.path a:link, div.path a:visited { color: #000; }
        table.coverage { border-collapse: collapse; margin:0; padding: 0 }

        table.coverage td {
            margin: 0;
            padding: 0;
            color: #111;
            vertical-align: top;
        }
        table.coverage td.line-count {
            width: 50px;
            text-align: right;
            padding-right: 5px;
        }
        table.coverage td.line-coverage {
            color: #777 !important;
            text-align: right;
            border-left: 1px solid #666;
            border-right: 1px solid #666;
        }

        table.coverage td.text {
        }

        table.coverage td span.cline-any {
            display: inline-block;
            padding: 0 5px;
            width: 40px;
        }
        table.coverage td span.cline-neutral {
            background: #eee;
        }
        table.coverage td span.cline-yes {
            background: #b5d592;
            color: #999;
        }
        table.coverage td span.cline-no {
            background: #fc8c84;
        }

        .cstat-yes { color: #111; }
        .cstat-no { background: #fc8c84; color: #111; }
        .fstat-no { background: #ffc520; color: #111 !important; }
        .cbranch-no { background:  yellow !important; color: #111; }

        .cstat-skip { background: #ddd; color: #111; }
        .fstat-skip { background: #ddd; color: #111 !important; }
        .cbranch-skip { background: #ddd !important; color: #111; }

        .missing-if-branch {
            display: inline-block;
            margin-right: 10px;
            position: relative;
            padding: 0 4px;
            background: black;
            color: yellow;
        }

        .skip-if-branch {
            display: none;
            margin-right: 10px;
            position: relative;
            padding: 0 4px;
            background: #ccc;
            color: white;
        }

        .missing-if-branch .typ, .skip-if-branch .typ {
            color: inherit !important;
        }

        .entity, .metric { font-weight: bold; }
        .metric { display: inline-block; border: 1px solid #333; padding: 0.3em; background: white; }
        .metric small { font-size: 80%; font-weight: normal; color: #666; }

        div.coverage-summary table { border-collapse: collapse; margin: 3em; font-size: 110%; }
        div.coverage-summary td, div.coverage-summary table  th { margin: 0; padding: 0.25em 1em; border-top: 1px solid #666; border-bottom: 1px solid #666; }
        div.coverage-summary th { text-align: left; border: 1px solid #666; background: #eee; font-weight: normal; }
        div.coverage-summary th.file { border-right: none !important; }
        div.coverage-summary th.pic { border-left: none !important; text-align: right; }
        div.coverage-summary th.pct { border-right: none !important; }
        div.coverage-summary th.abs { border-left: none !important; text-align: right; }
        div.coverage-summary td.pct { text-align: right; border-left: 1px solid #666; }
        div.coverage-summary td.abs { text-align: right; font-size: 90%; color: #444; border-right: 1px solid #666; }
        div.coverage-summary td.file { text-align: right; border-left: 1px solid #666; white-space: nowrap;  }
        div.coverage-summary td.pic { min-width: 120px !important;  }
        div.coverage-summary a:link { color: #000; }
        div.coverage-summary a:visited { color: #333; }
        div.coverage-summary tfoot td { border-top: 1px solid #666; }

        div.coverage-summary .yui3-datatable-sort-indicator, div.coverage-summary .dummy-sort-indicator {
            height: 10px;
            width: 7px;
            display: inline-block;
            margin-left: 0.5em;
        }
        div.coverage-summary .yui3-datatable-sort-indicator {
            background: no-repeat scroll 0 0 transparent;
        }
        div.coverage-summary .yui3-datatable-sorted .yui3-datatable-sort-indicator {
            background-position: 0 -20px;
        }
        div.coverage-summary .yui3-datatable-sorted-desc .yui3-datatable-sort-indicator {
            background-position: 0 -10px;
        }

        .high { background: #b5d592 !important; }
        .medium { background: #ffe87c !important; }
        .low { background: #fc8c84 !important; }

        span.cover-fill, span.cover-empty {
            display:inline-block;
            border:1px solid #444;
            background: white;
            height: 12px;
        }
        span.cover-fill {
            background: #ccc;
            border-right: 1px solid #444;
        }
        span.cover-empty {
            background: white;
            border-left: none;
        }
        span.cover-full {
            border-right: none !important;
        }
        pre.prettyprint {
            border: none !important;
            padding: 0 !important;
            margin: 0 !important;
        }
        .com { color: #999 !important; }
        .ignore-none { color: #999; font-weight: normal; }

    </style>
</head>
<body>
<div class="header low">
    <h1 style="font-weight: bold;">
        <a href="https://github.com/npmtest/node-npmtest-asyncawait">npmtest-asyncawait (v0.0.1)</a>
    </h1>
    <h1>Code coverage report for <span class="entity">node-npmtest-asyncawait/node_modules/asyncawait/src/async/makeAsyncFunc.js</span></h1>
    <h2>
        
        Statements: <span class="metric">21.65% <small>(42 / 194)</small></span> &nbsp;&nbsp;&nbsp;&nbsp;
        
        
        Branches: <span class="metric">8.93% <small>(5 / 56)</small></span> &nbsp;&nbsp;&nbsp;&nbsp;
        
        
        Functions: <span class="metric">11.11% <small>(3 / 27)</small></span> &nbsp;&nbsp;&nbsp;&nbsp;
        
        
        Lines: <span class="metric">26.42% <small>(42 / 159)</small></span> &nbsp;&nbsp;&nbsp;&nbsp;
        
        Ignored: <span class="metric"><span class="ignore-none">none</span></span> &nbsp;&nbsp;&nbsp;&nbsp;
    </h2>
    <div class="path"><a href="../../../../../index.html">All files</a> &#187; <a href="index.html">node-npmtest-asyncawait/node_modules/asyncawait/src/async/</a> &#187; makeAsyncFunc.js</div>
</div>
<div class="body">
<pre><table class="coverage">
<tr><td class="line-count">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226</td><td class="line-coverage"><span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">5</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">5</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">5</span>
<span class="cline-any cline-yes">5</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">5</span>
<span class="cline-any cline-yes">4</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">4</span>
<span class="cline-any cline-yes">4</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">4</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">4</span>
<span class="cline-any cline-yes">4</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">var Fiber = require('../fibers');
var _ = require('lodash');
var Config = require('./config');
var FiberMgr = require('./fiberManager');
var RunContext = require('./runContext');
var Semaphore = require('./semaphore');
var AsyncIterator = require('./asyncIterator');
var defer = require('./defer');
var await = require('../await/index');
/** Function for creating a specific variant of the async function. */
function makeAsyncFunc(config) {
    // Validate the specified configuration
    config.validate();
    // Create an async function tailored to the given options.
    var result = <span class="fstat-no" title="function not covered" >function async(bodyFunc) {</span>
        // Create a semaphore for limiting top-level concurrency, if specified in options.
<span class="cstat-no" title="statement not covered" >        var semaphore = config.maxConcurrency ? new Semaphore(config.maxConcurrency) : Semaphore.unlimited;</span>
        // Choose and run the appropriate function factory based on whether the result should be iterable.
<span class="cstat-no" title="statement not covered" >        var makeFunc = config.isIterable ? makeAsyncIterator : makeAsyncNonIterator;</span>
<span class="cstat-no" title="statement not covered" >        var result = makeFunc(bodyFunc, config, semaphore);</span>
        // Ensure the suspendable function's arity matches that of the function it wraps.
<span class="cstat-no" title="statement not covered" >        var arity = bodyFunc.length;</span>
<span class="cstat-no" title="statement not covered" >        if (config.acceptsCallback)</span>
<span class="cstat-no" title="statement not covered" >            ++arity;</span>
<span class="cstat-no" title="statement not covered" >        result = makeFuncWithArity(result, arity);</span>
<span class="cstat-no" title="statement not covered" >        return result;</span>
    };
    // Add the mod() function, and return the result.
    result.mod = makeModFunc(config);
    return result;
}
/** Function for creating iterable suspendable functions. */
<span class="fstat-no" title="function not covered" >function makeAsyncIterator(bodyFunc, config, semaphore) {</span>
    // Return a function that returns an iterator.
<span class="cstat-no" title="statement not covered" >    return <span class="fstat-no" title="function not covered" >function iterable() {</span></span>
        // Capture the initial arguments used to start the iterator, as an array.
<span class="cstat-no" title="statement not covered" >        var startupArgs = new Array(arguments.length + 1); </span>// Reserve 0th arg for the yield function. 
<span class="cstat-no" title="statement not covered" >        for (var i = 0, len = arguments.length; i &lt; len; ++i)</span>
<span class="cstat-no" title="statement not covered" >            startupArgs[i + 1] = arguments[i];</span>
        // Create a yield() function tailored for this iterator.
<span class="cstat-no" title="statement not covered" >        var yield_ = <span class="fstat-no" title="function not covered" >function (expr) {</span></span>
            // Ensure this function is executing inside a fiber.
<span class="cstat-no" title="statement not covered" >            if (!Fiber.current) {</span>
<span class="cstat-no" title="statement not covered" >                throw new Error('await functions, yield functions, and value-returning suspendable ' +</span>
                    'functions may only be called from inside a suspendable function. ');
            }
            // Notify waiters of the next result, then suspend the iterator.
<span class="cstat-no" title="statement not covered" >            if (runContext.callback)</span>
<span class="cstat-no" title="statement not covered" >                runContext.callback(null, { value: expr, done: false });</span>
<span class="cstat-no" title="statement not covered" >            if (runContext.resolver)</span>
<span class="cstat-no" title="statement not covered" >                runContext.resolver.resolve({ value: expr, done: false });</span>
<span class="cstat-no" title="statement not covered" >            Fiber.yield();</span>
        };
        // Insert the yield function as the first argument when starting the iterator.
<span class="cstat-no" title="statement not covered" >        startupArgs[0] = yield_;</span>
        // Create the iterator.
<span class="cstat-no" title="statement not covered" >        var runContext = new RunContext(bodyFunc, this, startupArgs);</span>
<span class="cstat-no" title="statement not covered" >        var iterator = new AsyncIterator(runContext, semaphore, config.returnValue, config.acceptsCallback);</span>
        // Wrap the given bodyFunc to properly complete the iteration.
<span class="cstat-no" title="statement not covered" >        runContext.wrapped = <span class="fstat-no" title="function not covered" >function () {</span></span>
<span class="cstat-no" title="statement not covered" >            var len = arguments.length, args = new Array(len);</span>
<span class="cstat-no" title="statement not covered" >            for (var i = 0; i &lt; len; ++i)</span>
<span class="cstat-no" title="statement not covered" >                args[i] = arguments[i];</span>
<span class="cstat-no" title="statement not covered" >            bodyFunc.apply(this, args);</span>
<span class="cstat-no" title="statement not covered" >            iterator.destroy();</span>
<span class="cstat-no" title="statement not covered" >            return { done: true };</span>
        };
        // Return the iterator.
<span class="cstat-no" title="statement not covered" >        return iterator;</span>
    };
}
/** Function for creating non-iterable suspendable functions. */
<span class="fstat-no" title="function not covered" >function makeAsyncNonIterator(bodyFunc, config, semaphore) {</span>
    // Return a function that executes fn in a fiber and returns a promise of fn's result.
<span class="cstat-no" title="statement not covered" >    return <span class="fstat-no" title="function not covered" >function nonIterable() {</span></span>
        // Get all the arguments passed in, as an array.
<span class="cstat-no" title="statement not covered" >        var argsAsArray = new Array(arguments.length);</span>
<span class="cstat-no" title="statement not covered" >        for (var i = 0; i &lt; argsAsArray.length; ++i)</span>
<span class="cstat-no" title="statement not covered" >            argsAsArray[i] = arguments[i];</span>
        // Remove concurrency restrictions for nested calls, to avoid race conditions.
<span class="cstat-no" title="statement not covered" >        if (FiberMgr.isExecutingInFiber())</span>
<span class="cstat-no" title="statement not covered" >            this._semaphore = Semaphore.unlimited;</span>
        // Configure the run context.
<span class="cstat-no" title="statement not covered" >        var runContext = new RunContext(bodyFunc, this, argsAsArray, <span class="fstat-no" title="function not covered" >function () {</span> <span class="cstat-no" title="statement not covered" >return semaphore.leave(); </span>});</span>
<span class="cstat-no" title="statement not covered" >        if (config.returnValue !== Config.NONE) {</span>
<span class="cstat-no" title="statement not covered" >            var resolver = defer();</span>
<span class="cstat-no" title="statement not covered" >            runContext.resolver = resolver;</span>
        }
<span class="cstat-no" title="statement not covered" >        if (config.acceptsCallback &amp;&amp; argsAsArray.length &amp;&amp; _.isFunction(argsAsArray[argsAsArray.length - 1])) {</span>
<span class="cstat-no" title="statement not covered" >            var callback = argsAsArray.pop();</span>
<span class="cstat-no" title="statement not covered" >            runContext.callback = callback;</span>
        }
        // Execute bodyFunc to completion in a coroutine. For thunks, this is a lazy operation.
<span class="cstat-no" title="statement not covered" >        if (config.returnValue === Config.THUNK) {</span>
<span class="cstat-no" title="statement not covered" >            var thunk = <span class="fstat-no" title="function not covered" >function (done) {</span></span>
<span class="cstat-no" title="statement not covered" >                if (done)</span>
<span class="cstat-no" title="statement not covered" >                    resolver.promise.then(<span class="fstat-no" title="function not covered" >function (val) {</span> <span class="cstat-no" title="statement not covered" >return done(null, val); </span>}, <span class="fstat-no" title="function not covered" >function (err) {</span> <span class="cstat-no" title="statement not covered" >return done(err); </span>});</span>
<span class="cstat-no" title="statement not covered" >                semaphore.enter(<span class="fstat-no" title="function not covered" >function () {</span> <span class="cstat-no" title="statement not covered" >return FiberMgr.create().run(runContext); </span>});</span>
            };
        }
        else {
<span class="cstat-no" title="statement not covered" >            semaphore.enter(<span class="fstat-no" title="function not covered" >function () {</span> <span class="cstat-no" title="statement not covered" >return FiberMgr.create().run(runContext); </span>});</span>
        }
        // Return the appropriate value.
<span class="cstat-no" title="statement not covered" >        switch (config.returnValue) {</span>
            case Config.PROMISE: <span class="cstat-no" title="statement not covered" >return resolver.promise;</span>
            case Config.THUNK: <span class="cstat-no" title="statement not covered" >return thunk;</span>
            case Config.RESULT: <span class="cstat-no" title="statement not covered" >return await(resolver.promise);</span>
            case Config.NONE: <span class="cstat-no" title="statement not covered" >return;</span>
        }
    };
}
/** Returns a function that directly proxies the given function, whilst reporting the given arity. */
<span class="fstat-no" title="function not covered" >function makeFuncWithArity(fn, arity) {</span>
    // Need to handle each arity individually, but the body never changes.
<span class="cstat-no" title="statement not covered" >    switch (arity) {</span>
        case 0: <span class="cstat-no" title="statement not covered" >return <span class="fstat-no" title="function not covered" >function f0() {</span> <span class="cstat-no" title="statement not covered" >var i, l = arguments.length, r = new Array(l); <span class="cstat-no" title="statement not covered" ></span>for (i = 0; i &lt; l; ++i)</span></span>
<span class="cstat-no" title="statement not covered" >            r[i] = arguments[i]; <span class="cstat-no" title="statement not covered" ></span>return fn.apply(this, r); </span>};
        case 1: <span class="cstat-no" title="statement not covered" >return <span class="fstat-no" title="function not covered" >function f1(a) {</span> <span class="cstat-no" title="statement not covered" >var i, l = arguments.length, r = new Array(l); <span class="cstat-no" title="statement not covered" ></span>for (i = 0; i &lt; l; ++i)</span></span>
<span class="cstat-no" title="statement not covered" >            r[i] = arguments[i]; <span class="cstat-no" title="statement not covered" ></span>return fn.apply(this, r); </span>};
        case 2: <span class="cstat-no" title="statement not covered" >return <span class="fstat-no" title="function not covered" >function f2(a, b) {</span> <span class="cstat-no" title="statement not covered" >var i, l = arguments.length, r = new Array(l); <span class="cstat-no" title="statement not covered" ></span>for (i = 0; i &lt; l; ++i)</span></span>
<span class="cstat-no" title="statement not covered" >            r[i] = arguments[i]; <span class="cstat-no" title="statement not covered" ></span>return fn.apply(this, r); </span>};
        case 3: <span class="cstat-no" title="statement not covered" >return <span class="fstat-no" title="function not covered" >function f3(a, b, c) {</span> <span class="cstat-no" title="statement not covered" >var i, l = arguments.length, r = new Array(l); <span class="cstat-no" title="statement not covered" ></span>for (i = 0; i &lt; l; ++i)</span></span>
<span class="cstat-no" title="statement not covered" >            r[i] = arguments[i]; <span class="cstat-no" title="statement not covered" ></span>return fn.apply(this, r); </span>};
        case 4: <span class="cstat-no" title="statement not covered" >return <span class="fstat-no" title="function not covered" >function f4(a, b, c, d) {</span> <span class="cstat-no" title="statement not covered" >var i, l = arguments.length, r = new Array(l); <span class="cstat-no" title="statement not covered" ></span>for (i = 0; i &lt; l; ++i)</span></span>
<span class="cstat-no" title="statement not covered" >            r[i] = arguments[i]; <span class="cstat-no" title="statement not covered" ></span>return fn.apply(this, r); </span>};
        case 5: <span class="cstat-no" title="statement not covered" >return <span class="fstat-no" title="function not covered" >function f5(a, b, c, d, e) {</span> <span class="cstat-no" title="statement not covered" >var i, l = arguments.length, r = new Array(l); <span class="cstat-no" title="statement not covered" ></span>for (i = 0; i &lt; l; ++i)</span></span>
<span class="cstat-no" title="statement not covered" >            r[i] = arguments[i]; <span class="cstat-no" title="statement not covered" ></span>return fn.apply(this, r); </span>};
        case 6: <span class="cstat-no" title="statement not covered" >return <span class="fstat-no" title="function not covered" >function f6(a, b, c, d, e, f) {</span> <span class="cstat-no" title="statement not covered" >var i, l = arguments.length, r = new Array(l); <span class="cstat-no" title="statement not covered" ></span>for (i = 0; i &lt; l; ++i)</span></span>
<span class="cstat-no" title="statement not covered" >            r[i] = arguments[i]; <span class="cstat-no" title="statement not covered" ></span>return fn.apply(this, r); </span>};
        case 7: <span class="cstat-no" title="statement not covered" >return <span class="fstat-no" title="function not covered" >function f7(a, b, c, d, e, f, g) {</span> <span class="cstat-no" title="statement not covered" >var i, l = arguments.length, r = new Array(l); <span class="cstat-no" title="statement not covered" ></span>for (i = 0; i &lt; l; ++i)</span></span>
<span class="cstat-no" title="statement not covered" >            r[i] = arguments[i]; <span class="cstat-no" title="statement not covered" ></span>return fn.apply(this, r); </span>};
        case 8: <span class="cstat-no" title="statement not covered" >return <span class="fstat-no" title="function not covered" >function f8(a, b, c, d, e, f, g, h) {</span> <span class="cstat-no" title="statement not covered" >var i, l = arguments.length, r = new Array(l); <span class="cstat-no" title="statement not covered" ></span>for (i = 0; i &lt; l; ++i)</span></span>
<span class="cstat-no" title="statement not covered" >            r[i] = arguments[i]; <span class="cstat-no" title="statement not covered" ></span>return fn.apply(this, r); </span>};
        case 9: <span class="cstat-no" title="statement not covered" >return <span class="fstat-no" title="function not covered" >function f9(a, b, c, d, e, f, g, h, _i) {</span> <span class="cstat-no" title="statement not covered" >var i, l = arguments.length, r = new Array(l); <span class="cstat-no" title="statement not covered" ></span>for (i = 0; i &lt; l; ++i)</span></span>
<span class="cstat-no" title="statement not covered" >            r[i] = arguments[i]; <span class="cstat-no" title="statement not covered" ></span>return fn.apply(this, r); </span>};
        default: <span class="cstat-no" title="statement not covered" >return fn; </span>// Bail out if arity is crazy high.
    }
}
function makeModFunc(config) {
    return function (options, maxConcurrency) {
        <span class="missing-if-branch" title="else path not taken" >E</span>if (_.isString(options)) {
            // This way of specifying options is useful for TypeScript users, as they get better type information.
            // JavaScript users can use this too, but providing an options hash is more useful in that case. 
            var rt, cb, it;
            switch (options) {
<span class="branch-0 cbranch-no" title="branch not covered" >                case 'returns: promise, callback: false, iterable: false':</span>
<span class="cstat-no" title="statement not covered" >                    rt = 'promise';</span>
<span class="cstat-no" title="statement not covered" >                    cb = false;</span>
<span class="cstat-no" title="statement not covered" >                    it = false;</span>
<span class="cstat-no" title="statement not covered" >                    break;</span>
                case 'returns: thunk, callback: false, iterable: false':
                    rt = 'thunk';
                    cb = false;
                    it = false;
                    break;
                case 'returns: result, callback: false, iterable: false':
                    rt = 'result';
                    cb = false;
                    it = false;
                    break;
<span class="branch-3 cbranch-no" title="branch not covered" >                case 'returns: promise, callback: true, iterable: false':</span>
<span class="cstat-no" title="statement not covered" >                    rt = 'promise';</span>
<span class="cstat-no" title="statement not covered" >                    cb = true;</span>
<span class="cstat-no" title="statement not covered" >                    it = false;</span>
<span class="cstat-no" title="statement not covered" >                    break;</span>
<span class="branch-4 cbranch-no" title="branch not covered" >                case 'returns: thunk, callback: true, iterable: false':</span>
<span class="cstat-no" title="statement not covered" >                    rt = 'thunk';</span>
<span class="cstat-no" title="statement not covered" >                    cb = true;</span>
<span class="cstat-no" title="statement not covered" >                    it = false;</span>
<span class="cstat-no" title="statement not covered" >                    break;</span>
<span class="branch-5 cbranch-no" title="branch not covered" >                case 'returns: result, callback: true, iterable: false':</span>
<span class="cstat-no" title="statement not covered" >                    rt = 'result';</span>
<span class="cstat-no" title="statement not covered" >                    cb = true;</span>
<span class="cstat-no" title="statement not covered" >                    it = false;</span>
<span class="cstat-no" title="statement not covered" >                    break;</span>
                case 'returns: none, callback: true, iterable: false':
                    rt = 'none';
                    cb = true;
                    it = false;
                    break;
                case 'returns: promise, callback: false, iterable: true':
                    rt = 'promise';
                    cb = false;
                    it = true;
                    break;
<span class="branch-8 cbranch-no" title="branch not covered" >                case 'returns: thunk, callback: false, iterable: true':</span>
<span class="cstat-no" title="statement not covered" >                    rt = 'thunk';</span>
<span class="cstat-no" title="statement not covered" >                    cb = false;</span>
<span class="cstat-no" title="statement not covered" >                    it = true;</span>
<span class="cstat-no" title="statement not covered" >                    break;</span>
<span class="branch-9 cbranch-no" title="branch not covered" >                case 'returns: result, callback: false, iterable: true':</span>
<span class="cstat-no" title="statement not covered" >                    rt = 'result';</span>
<span class="cstat-no" title="statement not covered" >                    cb = false;</span>
<span class="cstat-no" title="statement not covered" >                    it = true;</span>
<span class="cstat-no" title="statement not covered" >                    break;</span>
<span class="branch-10 cbranch-no" title="branch not covered" >                case 'returns: promise, callback: true, iterable: true':</span>
<span class="cstat-no" title="statement not covered" >                    rt = 'promise';</span>
<span class="cstat-no" title="statement not covered" >                    cb = true;</span>
<span class="cstat-no" title="statement not covered" >                    it = true;</span>
<span class="cstat-no" title="statement not covered" >                    break;</span>
<span class="branch-11 cbranch-no" title="branch not covered" >                case 'returns: thunk, callback: true, iterable: true':</span>
<span class="cstat-no" title="statement not covered" >                    rt = 'thunk';</span>
<span class="cstat-no" title="statement not covered" >                    cb = true;</span>
<span class="cstat-no" title="statement not covered" >                    it = true;</span>
<span class="cstat-no" title="statement not covered" >                    break;</span>
<span class="branch-12 cbranch-no" title="branch not covered" >                case 'returns: result, callback: true, iterable: true':</span>
<span class="cstat-no" title="statement not covered" >                    rt = 'result';</span>
<span class="cstat-no" title="statement not covered" >                    cb = true;</span>
<span class="cstat-no" title="statement not covered" >                    it = true;</span>
<span class="cstat-no" title="statement not covered" >                    break;</span>
<span class="branch-13 cbranch-no" title="branch not covered" >                case 'returns: none, callback: true, iterable: true':</span>
<span class="cstat-no" title="statement not covered" >                    rt = 'none';</span>
<span class="cstat-no" title="statement not covered" >                    cb = true;</span>
<span class="cstat-no" title="statement not covered" >                    it = true;</span>
<span class="cstat-no" title="statement not covered" >                    break;</span>
            }
            options = { returnValue: rt, acceptsCallback: cb, isIterable: it, maxConcurrency: maxConcurrency };
        }
        var newConfig = new Config(_.defaults({}, options, config));
        return makeAsyncFunc(newConfig);
    };
}
module.exports = makeAsyncFunc;
//# sourceMappingURL=makeAsyncFunc.js.map
&nbsp;</pre></td></tr>
</table></pre>
</div>
<div class="footer">
    <div class="meta">Generated by <a href="https://github.com/kaizhu256/node-utility2" target="_blank">utility2</a> at Mon Apr 17 2017 19:22:08 GMT+0000 (UTC)</div>
</div>
</body>
</html>
